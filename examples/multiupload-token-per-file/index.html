<html>

<head>
</head>

<body>
  <input type="file" multiple />
  <div class="controls">
    <button id="cancel">Cancel</button>
    <button id="pause">Pause</button>
    <button id="resume">Resume</button>
  </div>
  <div>Progress: <span id="progress"></span></div>
  <script src="./../../../../build/browser/filestack.umd.js"></script>
  <script>
    window.addEventListener('DOMContentLoaded', function () {
      const apikey = 'A0NTRSxHcR66kmTku9Gcsz';
      const client = filestack.init(apikey);
      const onProgress = (evt) => {
        document.getElementById('progress').innerHTML = `${evt.totalPercent}%`;
      };

      document.querySelector('input').addEventListener('change', (event) => {
        const files = event.target.files;
        const arrOfFiles = Object.keys(files).map(function(key) {
          return files[key];
        });
        let token = {};
        const cancel = document.getElementById('cancel');
        const pause = document.getElementById('pause');
        const resume = document.getElementById('resume');
        const entries = Object.entries(event.target.files);

        for (const [key, file] of entries) {
          let cancelBtn = document.createElement('button');
          cancelBtn.id = file.name;
          cancelBtn.innerText = `Cancel ${file.name}`;
          cancelBtn.addEventListener('click', () => {
            token[file.name].cancel();
          });
          document.querySelector('body').appendChild(cancelBtn);
        }

        [resume, pause, cancel].forEach((btn) => {
          const id = btn.id;
          btn.addEventListener('click', () => {
            token[id]();
          });
        });

        client.multiupload(arrOfFiles, { onProgress, cancelTokenPerFile: true }, {}, token)
          .then(res => {
            console.log('success: ', res)
          })
          .catch(err => {
            console.log(err)
          });
      });
    });
  </script>
</body>

</html>